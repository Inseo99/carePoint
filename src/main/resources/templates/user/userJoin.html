<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>회원가입페이지</title>
    <link href="/css/user/join.css" type="text/css" rel="stylesheet">
</head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<body>
<!--<script>
    // 모달 팝업 띄우기
    window.onload = function () {
        document.getElementById("termsModal").style.display = "block";
    };

    // 모달 닫기
    function closeModal() {
        document.getElementById("termsModal").style.display = "none";
    }

    // 약관 동의 시 회원가입 폼 보이기
    function agreeTerms() {

        // 모든 체크박스 요소 가져오기
        let checkboxes = document.querySelectorAll("#termsModal input[type='checkbox']");
        let allChecked = true;

        // 모든 체크박스가 체크되었는지 확인
        checkboxes.forEach(function (checkbox) {
            if (!checkbox.checked) {
                allChecked = false;
            }
        });

        if (!allChecked) {
            alert("모든 필수 약관에 동의해야 합니다.");
            return; // 함수 종료
        }

        closeModal();  // 모달 닫기
        document.getElementById("signupForm").style.display = "block";  // 회원가입 폼 보이기
    }

    function declineTerms() {
        alert("약관에 동의하지 않으면 회원가입이 불가능합니다.");

    }


</script> 약관 동의 모달 스크립트 일단 주석 todo-->
<!-- 유효성 검사 스크립트 불러오기 -->
<script>
    function joinCheck(){
        alert("test");

        //유효성 검사하기
        let fm = document.frm;

        if(fm.username.value==="") {
            alert("이름을 입력해주세요");
            fm.username.focus();
            return;
        }else if(fm.usernick.value==="") {
            alert("닉네임을 입력해주세요");
            fm.usernick.focus();
            return;
        }else if ($("#nick-btn").val() === "N") { // 닉네임 중복확인 여부 확인
            alert("닉네임 중복확인을 해주세요");
            return;
        }else if(fm.userid.value==="") {
            alert("아이디를 입력해주세요");
            fm.userid.focus();
            return;
        }else if ($("#id-btn").val() === "N") { // 아이디 중복확인 여부 확인
            alert("아이디 중복확인을 해주세요");
            return;
        }else if (fm.userpwd.value===""){
            alert("비밀번호를 입력해주세요");
            fm.userpwd.focus();
            return;
        }else if(fm.userpwd2.value==="") {
            alert("비밀번호를 확인해주세요");
            fm.userpwd2.focus();
            return;
        }else if(fm.userpwd.value !== fm.userpwd2.value) {
            alert("비밀번호가 일치하지 않습니다.");
            fm.userpwd2.value="";	// 값 초기화
            fm.userpwd2.focus();	// 포커스
            return;
        }else if(fm.phone.value==="") {
            alert("전화번호를 입력해주세요");
            fm.phone.focus();
            return;
        }else if(fm.email.value==="") {
            alert("이메일을 입력해주세요");
            fm.email.focus();
            return;
        }



// check 함수 끝

        let ans = confirm("회원가입 하시겠습니까?");

        if (ans === true){
            fm.action="${pageContext.request.contextPath}/user/userJoinAction.aws";
            fm.method="post";
            fm.submit();
        }

    }


    function checkUserId() {
        let userid = $("#userid").val();
        if (userid === "") {
            alert("아이디 입력란이 공란입니다.");
            return;
        } // 입력란에 아무것도 입력하지 않은 경우 다시 입력하도록 제한

        $.ajax({
            type: "post",
            url: "/user/userIdCheck.aws",
            dataType: "json",
            data: {"userid": userid},
            success: function(result) {
                if (result.cnt === 0) {	// 사용가능한 경우
                    alert("사용할 수 있는 아이디입니다.");
                    $("#id-btn").val("Y");

                } else {
                    alert("사용할 수 없는 아이디입니다.");
                    $("#userid").val(""); // 입력한 아이디 지우기

                }
            },
            error: function() {
                alert("전송 실패");
            }
        });
    }
    //아이디 중복체크 완료

    function checkNickname() {
        let usernick = $("#usernick").val();
        if (usernick === "") {
            alert("닉네임 입력란이 공란입니다.");
            return;
        } // 입력란에 아무것도 입력하지 않은 경우 다시 입력하도록 제한
        $.ajax({
            type: "post",
            url: "/user/userNickCheck.aws",
            dataType: "json",
            data: {"usernick": usernick},
            success: function(result) {
                if (result.cnt === 0) {
                    alert("사용할 수 있는 닉네임입니다.");
                    $("#nick-btn").val("Y");

                } else {
                    alert("사용할 수 없는 닉네임입니다.");
                    $("#usernick").val(""); // 입력한 아이디 지우기

                }
            },
            error: function() {
                alert("전송 실패");
            }
        });
    }


</script>
<div th:insert="/common/header.html"></div>

<!-- 약관 동의 모달 팝업 -->
<div id="termsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>약관 동의</h2>
        </div>
        <div class="modal-body">
            <br><br>
            <label>
                <input type="checkbox">
                개인정보 수집 및 이용약관 동의 (<span style="color: red;">필수</span>)
            </label>
            <div class="terms-container">

                <div class="terms-box">
                    <p><strong>1. 수집 목적</strong></p>
                    <p>회원 서비스 제공 및 관리</p>
                    <p><strong>2. 수집 항목</strong></p>
                    <ul>
                        <li>필수: 성명, 아이디, 비밀번호, 닉네임, 이메일, 질병상세정보</li>
                        <li>선택: 이메일 수신 여부, 카카오톡 수신 여부</li>
                        <li>자동 수집: 서비스 이용 기록, 접속 로그, 쿠키, 접속 IP 정보</li>
                    </ul>
                    <p><strong>3. 개인정보의 보유 및 이용기간</strong></p>
                    <p>회원 탈퇴 시 즉시 삭제 (법령에 따라 일부 정보 보관 가능)</p>
                    <p><strong>4. 개인정보의 파기절차 및 방법</strong></p>
                    <p>전자적 파일: 기술적 삭제, 종이 문서: 분쇄 또는 소각</p>
                    <p><strong>5. 동의 철회 및 회원 탈퇴 방법</strong></p>
                    <p>홈페이지 내 회원 탈퇴 기능 이용 가능</p>
                    <p><strong>6. 개인정보 자동 수집 거부 설정</strong></p>
                    <p>브라우저 설정을 통해 쿠키 수집 거부 가능</p>
                    <p><strong>7. 개인정보관리책임자</strong></p>
                    <div class="contact">
                        <p><strong>이름:</strong> 이인아</p>
                        <p><strong>직위:</strong> carepoint</p>
                        <p><strong>전화번호:</strong> 042-872-2360</p>
                    </div>
                    <p><strong>공고일자:</strong> 2025년 2월 3일</p>
                    <p><strong>시행일자:</strong> 2025년 2월 3일</p>
                </div> <!--개인정보 동의 약관 1-->
            </div>
            <br>

            <label>
                <input type="checkbox">
                카카오톡, 이메일 수신 동의 (<span style="color: red;">필수</span>)
            </label>
            <div class="terms-box">
                <p>개인정보 활용 동의 내용<br>1. 수집목적<br>2. 수집항목</p>
            </div><!--개인정보 동의 약관 2--><!--todo-->
        </div>

        <div class="modal-footer">
            <button class="modal-button" onclick="declineTerms()">취소</button>
            <button class="modal-button" onclick="agreeTerms()">회원가입하기</button>
        </div>
    </div>
</div>
<!-- 회원가입 폼 -->
<main>
    <section class="registration-form">
        <h1>회원가입</h1>
        <form name="frm" action="/user/userJoinAction" method="post">

            <div class="form-group">
                <label>이름</label>
                <input type="text" id="username" name="username" placeholder="이름을 입력하세요" required>
            </div>

            <div class="form-group">
                <label>닉네임</label>
                <div class="check">
                    <input type="text" id="usernick" name="usernick" placeholder="닉네임을 입력하세요" required>
                    <button type="button" id="nick-btn" class="check-btn" onclick="checkNickname()" value="N">중복확인</button>
                </div>
            </div>

            <div class="form-group">
                <label>아이디</label>
                <div class="check">
                    <input type="text" id="userid" name="userid" placeholder="아이디를 입력하세요" required>
                    <button type="button" id="id-btn" class="check-btn" onclick="checkUserId()" value="N">중복확인</button>
                </div>
            </div>

            <div class="form-group">
                <label>비밀번호</label>
                <input type="password" id="userpwd" name="userpwd" placeholder="비밀번호를 입력하세요" required>
            </div>

            <div class="form-group">
                <label>비밀번호 확인</label>
                <input type="password" id="userpwd2" name="userpwd2" placeholder="비밀번호를 확인해주세요" required>
            </div>

            <div class="form-group">
                <label>전화번호</label>
                <input type="tel" id="phone" name="phone" placeholder="전화번호를 입력하세요" required>
            </div>

            <div class="form-group">
                <label>이메일</label>
                <input type="email" id="email" name="email" placeholder="이메일을 입력하세요" required>
            </div>

            <button class="join-btn" type="button" onClick="joinCheck();">회원가입하기</button>
        </form>
    </section>
</main>

<div th:insert="/common/footer.html"></div>

</body>
</html>